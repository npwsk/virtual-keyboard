(()=>{"use strict";const e={EN:"en",RU:"ru"},s=e=>1===e.length&&e.toUpperCase()!==e.toLowerCase(),a=({key:s,letterCase:a})=>{const t=(e=>{switch(e.toLowerCase()){case"upper":return"caseUp";case"lower":return"caseDown";default:throw new Error(`Unknown letter case: "${e}"`)}})(a);return Object.fromEntries(Object.values(e).map((e=>[e,s[e][t]])))},t=(e,s)=>{const{code:a}=e,t=e.uppercase[s],c=e.lowercase[s];let n;switch(a.toLowerCase()){case"tab":case"backspace":case"delete":case"capslock":case"enter":case"space":n=a.toLowerCase();break;case"shiftleft":case"shiftright":case"controlleft":case"controlright":case"metaleft":case"metaright":case"altleft":case"altright":n=a.toLowerCase().replace(/(right|left)/g,"")}const o=document.createElement("button");o.classList.add("key"),n&&o.classList.add(`key--${n}`),o.setAttribute("data-uppercase",t),o.setAttribute("data-lowercase",c),o.setAttribute("data-code",a);const r=document.createElement("div");r.classList.add("key__content");const i=document.createElement("div");i.classList.add("key__text","key__text--up-case"),i.textContent=t;const p=document.createElement("div");return p.classList.add("key__text","key__text--down-case"),t!==c&&t.toLowerCase()!==c&&(p.textContent=c??""),r.append(i,p),o.append(r),o},c=(e,s)=>{const a=document.querySelector(`[data-code=${e.code}]`);if(s){const c=t(e,s);a.innerHTML=c.innerHTML}e.isActive&&a.classList.add("key--active"),e.isActive||a.classList.remove("key--active")},n="CapsLock",o="Backspace",r="Delete",i="ArrowUp",p="ArrowDown",d="ArrowLeft",l="ArrowRight",u=(e,s)=>{const a=document.querySelector(".input-field");a.value=e,a.setSelectionRange(s,s),a.focus()},h=s=>{switch(s){case e.EN:return"En";case e.RU:return"Ru";default:throw new Error(`Unknown language: "${s}"`)}},w=JSON.parse('[[{"en":{"caseDown":"`","caseUp":"~"},"ru":{"caseDown":"ё","caseUp":"Ё"},"code":"Backquote"},{"en":{"caseDown":"1","caseUp":"!"},"ru":{"caseDown":"1","caseUp":"!"},"code":"Digit1"},{"en":{"caseDown":"2","caseUp":"@"},"ru":{"caseDown":"2","caseUp":"\\""},"code":"Digit2"},{"en":{"caseDown":"3","caseUp":"#"},"ru":{"caseDown":"3","caseUp":"№"},"code":"Digit3"},{"en":{"caseDown":"4","caseUp":"$"},"ru":{"caseDown":"4","caseUp":";"},"code":"Digit4"},{"en":{"caseDown":"5","caseUp":"%"},"ru":{"caseDown":"5","caseUp":"%"},"code":"Digit5"},{"en":{"caseDown":"6","caseUp":"^"},"ru":{"caseDown":"6","caseUp":":"},"code":"Digit6"},{"en":{"caseDown":"7","caseUp":"&"},"ru":{"caseDown":"7","caseUp":"?"},"code":"Digit7"},{"en":{"caseDown":"8","caseUp":"*"},"ru":{"caseDown":"8","caseUp":"*"},"code":"Digit8"},{"en":{"caseDown":"9","caseUp":"("},"ru":{"caseDown":"9","caseUp":"("},"code":"Digit9"},{"en":{"caseDown":"0","caseUp":")"},"ru":{"caseDown":"0","caseUp":")"},"code":"Digit0"},{"en":{"caseDown":"-","caseUp":"_"},"ru":{"caseDown":"-","caseUp":"_"},"code":"Minus"},{"en":{"caseDown":"=","caseUp":"+"},"ru":{"caseDown":"=","caseUp":"+"},"code":"Equal"},{"en":{"caseDown":"Backspace","caseUp":"Backspace"},"ru":{"caseDown":"Backspace","caseUp":"Backspace"},"code":"Backspace"}],[{"en":{"caseDown":"Tab","caseUp":"Tab"},"ru":{"caseDown":"Tab","caseUp":"Tab"},"code":"Tab"},{"en":{"caseDown":"q","caseUp":"Q"},"ru":{"caseDown":"й","caseUp":"Й"},"code":"KeyQ"},{"en":{"caseDown":"w","caseUp":"W"},"ru":{"caseDown":"ц","caseUp":"Ц"},"code":"KeyW"},{"en":{"caseDown":"e","caseUp":"E"},"ru":{"caseDown":"у","caseUp":"У"},"code":"KeyE"},{"en":{"caseDown":"r","caseUp":"R"},"ru":{"caseDown":"к","caseUp":"К"},"code":"KeyR"},{"en":{"caseDown":"t","caseUp":"T"},"ru":{"caseDown":"е","caseUp":"Е"},"code":"KeyT"},{"en":{"caseDown":"y","caseUp":"Y"},"ru":{"caseDown":"н","caseUp":"Н"},"code":"KeyY"},{"en":{"caseDown":"u","caseUp":"U"},"ru":{"caseDown":"г","caseUp":"Г"},"code":"KeyU"},{"en":{"caseDown":"i","caseUp":"I"},"ru":{"caseDown":"ш","caseUp":"Ш"},"code":"KeyI"},{"en":{"caseDown":"o","caseUp":"O"},"ru":{"caseDown":"щ","caseUp":"Щ"},"code":"KeyO"},{"en":{"caseDown":"p","caseUp":"P"},"ru":{"caseDown":"з","caseUp":"З"},"code":"KeyP"},{"en":{"caseDown":"[","caseUp":"{"},"ru":{"caseDown":"х","caseUp":"Х"},"code":"BracketLeft"},{"en":{"caseDown":"]","caseUp":"}"},"ru":{"caseDown":"ъ","caseUp":"Ъ"},"code":"BracketRight"},{"en":{"caseDown":"\\\\","caseUp":"|"},"ru":{"caseDown":"\\\\","caseUp":"/"},"code":"Backslash"},{"en":{"caseDown":"Del","caseUp":"Del"},"ru":{"caseDown":"Del","caseUp":"Del"},"code":"Delete"}],[{"en":{"caseDown":"CapsLock","caseUp":"CapsLock"},"ru":{"caseDown":"CapsLock","caseUp":"CapsLock"},"code":"CapsLock"},{"en":{"caseDown":"a","caseUp":"A"},"ru":{"caseDown":"ф","caseUp":"Ф"},"code":"KeyA"},{"en":{"caseDown":"s","caseUp":"S"},"ru":{"caseDown":"ы","caseUp":"Ы"},"code":"KeyS"},{"en":{"caseDown":"d","caseUp":"D"},"ru":{"caseDown":"в","caseUp":"В"},"code":"KeyD"},{"en":{"caseDown":"f","caseUp":"F"},"ru":{"caseDown":"а","caseUp":"А"},"code":"KeyF"},{"en":{"caseDown":"g","caseUp":"G"},"ru":{"caseDown":"п","caseUp":"П"},"code":"KeyG"},{"en":{"caseDown":"h","caseUp":"H"},"ru":{"caseDown":"р","caseUp":"Р"},"code":"KeyH"},{"en":{"caseDown":"j","caseUp":"J"},"ru":{"caseDown":"о","caseUp":"О"},"code":"KeyJ"},{"en":{"caseDown":"k","caseUp":"K"},"ru":{"caseDown":"л","caseUp":"Л"},"code":"KeyK"},{"en":{"caseDown":"l","caseUp":"L"},"ru":{"caseDown":"д","caseUp":"Д"},"code":"KeyL"},{"en":{"caseDown":";","caseUp":":"},"ru":{"caseDown":"ж","caseUp":"Ж"},"code":"Semicolon"},{"en":{"caseDown":"\\"","caseUp":"\'"},"ru":{"caseDown":"э","caseUp":"Э"},"code":"Quote"},{"en":{"caseDown":"Enter","caseUp":"Enter"},"ru":{"caseDown":"Enter","caseUp":"Enter"},"code":"Enter"}],[{"en":{"caseDown":"Shift","caseUp":"Shift"},"ru":{"caseDown":"Shift","caseUp":"Shift"},"code":"ShiftLeft"},{"en":{"caseDown":"z","caseUp":"Z"},"ru":{"caseDown":"я","caseUp":"Я"},"code":"KeyZ"},{"en":{"caseDown":"x","caseUp":"X"},"ru":{"caseDown":"ч","caseUp":"Ч"},"code":"KeyX"},{"en":{"caseDown":"c","caseUp":"C"},"ru":{"caseDown":"с","caseUp":"С"},"code":"KeyC"},{"en":{"caseDown":"v","caseUp":"V"},"ru":{"caseDown":"м","caseUp":"М"},"code":"KeyV"},{"en":{"caseDown":"b","caseUp":"B"},"ru":{"caseDown":"и","caseUp":"И"},"code":"KeyB"},{"en":{"caseDown":"n","caseUp":"N"},"ru":{"caseDown":"т","caseUp":"Т"},"code":"KeyN"},{"en":{"caseDown":"m","caseUp":"M"},"ru":{"caseDown":"ь","caseUp":"Ь"},"code":"KeyM"},{"en":{"caseDown":",","caseUp":"<"},"ru":{"caseDown":"б","caseUp":"Б"},"code":"Comma"},{"en":{"caseDown":".","caseUp":">"},"ru":{"caseDown":"ю","caseUp":"Ю"},"code":"Period"},{"en":{"caseDown":"/","caseUp":"?"},"ru":{"caseDown":".","caseUp":","},"code":"Slash"},{"en":{"caseDown":"↑","caseUp":"↑"},"ru":{"caseDown":"↑","caseUp":"↑"},"code":"ArrowUp"},{"en":{"caseDown":"Shift","caseUp":"Shift"},"ru":{"caseDown":"Shift","caseUp":"Shift"},"code":"ShiftRight"}],[{"en":{"caseDown":"Ctrl","caseUp":"Ctrl"},"ru":{"caseDown":"Ctrl","caseUp":"Ctrl"},"code":"ControlLeft"},{"en":{"caseDown":"Win","caseUp":"Win"},"ru":{"caseDown":"Win","caseUp":"Win"},"code":"MetaLeft"},{"en":{"caseDown":"Alt","caseUp":"Alt"},"ru":{"caseDown":"Alt","caseUp":"Alt"},"code":"AltLeft"},{"en":{"caseDown":" ","caseUp":" "},"ru":{"caseDown":" ","caseUp":" "},"code":"Space"},{"en":{"caseDown":"Alt","caseUp":"Alt"},"ru":{"caseDown":"Alt","caseUp":"Alt"},"code":"AltRight"},{"en":{"caseDown":"←","caseUp":"←"},"ru":{"caseDown":"←","caseUp":"←"},"code":"ArrowLeft"},{"en":{"caseDown":"↓","caseUp":"↓"},"ru":{"caseDown":"↓","caseUp":"↓"},"code":"ArrowDown"},{"en":{"caseDown":"→","caseUp":"→"},"ru":{"caseDown":"→","caseUp":"→"},"code":"ArrowRight"},{"en":{"caseDown":"Ctrl","caseUp":"Ctrl"},"ru":{"caseDown":"Ctrl","caseUp":"Ctrl"},"code":"ControlRight"}]]');document.addEventListener("DOMContentLoaded",(()=>{const D=localStorage.getItem("lang"),g=Object.values(e),U=w.flatMap(((t,c)=>t.map((t=>new class{uppercase={};lowercase={};code;row;isActive=!1;constructor({code:e,caseUp:s,caseDown:a,row:t}){this.code=e,this.uppercase=s,this.lowercase=a,this.row=t}isLetter(a){switch(a){case e.EN:return s(this.uppercase[e.EN]);case e.RU:return s(this.uppercase[e.RU]);default:return!1}}}({code:t.code,caseUp:a({key:t,letterCase:"upper"}),caseDown:a({key:t,letterCase:"lower"}),row:c}))))),y=new class extends class{#e=[];state;addObserver(e){this.#e.includes(e)||this.#e.push(e)}removeObserver(e){const s=this.#e.indexOf(e);s<0||this.#e.splice(s,1)}notify(e){for(const s of this.#e)s.update(e)}}{state={value:"",capsLock:!1,lng:e.EN};keys=[];keyElems=[];constructor({keys:e,initLang:s,langList:a}){super(),s&&(this.state.lng=s),this.keys=e,this.langs=a}toggleCapslock(){this.state.capsLock=!this.state.capsLock}getCurrentValue(){return this.state.value}getKeyByCode(e){return this.keys.find((s=>s.code===e))}updateValue(e){const s=this.getKeyByCode(e),a=this.keys.filter((e=>e.code.startsWith("Shift"))).some((e=>e.isActive));let t;switch(e){case"ControlLeft":case"ControlRight":case"ShiftLeft":case"ShiftRight":case"AltLeft":case"AltRight":case"MetaLeft":case r:case o:case d:case l:case i:case p:case n:t="";break;case"Tab":t="\t";break;case"Enter":t="\n";break;default:if(!this.state.capsLock&&a){t=s.uppercase[this.state.lng];break}if(this.state.capsLock&&!a){t=s.isLetter(this.state.lng)?s.uppercase[this.state.lng]:s.lowercase[this.state.lng];break}if(this.state.capsLock&&a){t=s.isLetter(this.state.lng)?s.lowercase[this.state.lng]:s.uppercase[this.state.lng];break}t=s.lowercase[this.state.lng]}this.state={...this.state,value:t}}pressKey(e){if(e===n&&this.state.capsLock)return void this.setKeyActive(e);if(e===n&&!this.state.capsLock)return void this.setKeyInactive(e);const s=this.getKeyByCode(e);s&&((e=>{document.querySelector(`[data-code=${e.code}]`).classList.add("key--pressed")})(s),this.updateValue(e))}setKeyActive(e){const s=this.getKeyByCode(e);s.isActive=!0,c(s)}setKeyInactive(e){if(e===n&&this.state.capsLock)return;const s=this.getKeyByCode(e);s.isActive=!1,c(s)}getLanguage(){return this.state.lng}setLanguage(e){this.state.lng=e,this.updateKeys(),this.notify({language:this.state.lng})}updateKeys(){this.keys.forEach((e=>c(e,this.state.lng)))}setNextLanguage(){const s=Object.values(e),a=(s.indexOf(this.state.lng)+1)%s.length;this.setLanguage(s[a])}init(e){const s=[];this.keys.forEach((e=>{s[e.row]||(s[e.row]=[]),s[e.row].push(e)})),((e,s,a)=>{const c=((e,s)=>{const a=document.createElement("div");a.classList.add("keyboard");const c=document.createElement("div");c.classList.add("keyboard__inner");const n=e.map((e=>{const a=document.createElement("div");a.classList.add("keyboard__row");const c=e.map((e=>{const a=t(e,s);return a.classList.add("keyboard__key"),a}));return a.append(...c),a}));return c.append(...n),a.append(c),a})(e,this.state.lng);s.append(c)})(s,e)}}({keys:U,initLang:D,langList:g}),L=new class{charsArr=[];inputEl=null;focus(){this.inputEl.focus()}addCharacter(e){if(0===e.length)return void this.focus();const s=this.inputEl.selectionStart,a=this.inputEl.selectionEnd;s!==a&&this.removeRange(s,a),this.charsArr.splice(s,0,e),u(this.charsArr.join(""),s+1)}removeRange(e,s){this.charsArr=this.charsArr.filter(((a,t)=>t<e||t>=s)),u(this.charsArr.join(""),e)}removePrevChar(){const e=this.inputEl.selectionStart,s=this.inputEl.selectionEnd;e===s?(this.charsArr=this.charsArr.filter(((s,a)=>a!==e-1)),u(this.charsArr.join(""),Math.max(e-1,0))):this.removeRange(e,s)}removeNextChar(){const e=this.inputEl.selectionStart,s=this.inputEl.selectionEnd;e===s?(this.charsArr=this.charsArr.filter(((s,a)=>a!==e)),u(this.charsArr.join(""),e)):this.removeRange(e,s)}moveCursorLeft(){const e=this.inputEl.selectionStart,s=e!==this.inputEl.selectionEnd?e:e-1;u(this.charsArr.join(""),Math.max(s,0))}moveCursorRight(){const e=this.inputEl.selectionStart,s=e!==this.inputEl.selectionEnd?e:e+1;u(this.charsArr.join(""),Math.min(s,this.charsArr.length))}init(e){this.inputEl=(e=>{const s=(()=>{const e=document.createElement("textarea");return e.classList.add("input-field"),e})();return e.append(s),s})(e)}},v=new class{#s=document.createElement("div");#a=[];constructor({languages:e,onLangChange:s}){this.#a=e.map((e=>new class{#s=document.createElement("div");#t=document.createElement("input");#c;#n;constructor({name:e,value:s,id:a,labelText:t,onChange:c}){this.#t.type="radio",this.#t.name=e,this.#t.value=s,this.#t.id=a,this.#c=t,this.#n=c}setActive(){this.#t.checked=!0}getLang(){return this.#t.value}init(){const e=document.createElement("label");return e.setAttribute("for",this.#t.id),e.textContent=this.#c,this.#t.addEventListener("change",(e=>this.#n(e.target.value))),this.#s.classList.add("radio-btn"),this.#s.append(this.#t,e),this.#s}}({name:"lang",value:e,id:`${e}-radio`,labelText:h(e),onChange:s})))}changeLang(e){this.#a.find((s=>s.getLang()===e)).setActive()}init({initLang:e}){const s=(e=>{const s=document.createElement("div");return s.innerHTML=e,s.firstElementChild})('\n    <div class="description">\n      <p>The virtual keyboard was created in Windows OS</p>\n      <p>Press Shift + Alt to change language</p>\n    </div>\n    ');this.changeLang(e);const a=this.#a.map((e=>e.init())),t=document.createElement("div");return t.append(...a),t.classList.add("radio-group"),this.#s.classList.add("side-bar"),this.#s.append(t,s),this.#s}update(e){Object.prototype.hasOwnProperty.call(e,"language")&&this.changeLang(e.language)}}({languages:Object.values(e),onLangChange:e=>y.setLanguage(e)});y.addObserver(v);const m=document.createElement("main");m.classList.add("app"),L.init(m),y.init(m);const f=v.init({initLang:y.getLanguage()});m.append(f),document.body.append(m),window.addEventListener("keydown",(e=>((e,s,a)=>{const{code:t}=e;s.getKeyByCode(t)&&(t!==i&&t!==p&&e.preventDefault(),s.setKeyActive(t),s.updateValue(t),t===n&&s.toggleCapslock(),t!==o?t!==r?t!==d?t!==l?a.addCharacter(s.getCurrentValue()):a.moveCursorRight():a.moveCursorLeft():a.removeNextChar():a.removePrevChar())})(e,y,L))),window.addEventListener("keyup",(e=>((e,s)=>{if(e.repeat)return;const{code:a,altKey:t,shiftKey:c}=e;s.getKeyByCode(a)&&((c&&a.startsWith("Alt")||t&&a.startsWith("Shift"))&&s.setNextLanguage(),setTimeout((()=>s.setKeyInactive(a)),200))})(e,y))),document.querySelectorAll(".keyboard__key").forEach((e=>{e.addEventListener("click",(e=>((e,s,a)=>{const{code:t}=e.currentTarget.dataset;if(t===n)return s.toggleCapslock(),s.state.capsLock?s.setKeyActive(t):s.setKeyInactive(t),void a.focus();s.pressKey(t),t!==o?t!==r?t!==d?t!==l?a.addCharacter(s.getCurrentValue()):a.moveCursorRight():a.moveCursorLeft():a.removeNextChar():a.removePrevChar()})(e,y,L))),e.addEventListener("animationend",(()=>e.classList.remove("key--pressed")))})),window.addEventListener("unload",(()=>localStorage.setItem("lang",y.state.lng)))}))})();