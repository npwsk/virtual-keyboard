(()=>{"use strict";const e={EN:"en",RU:"ru"},s=e=>1===e.length&&e.toUpperCase()!==e.toLowerCase(),c=({key:s,letterCase:c})=>{const a=(e=>{switch(e.toLowerCase()){case"upper":return"caseUp";case"lower":return"caseDown";default:throw new Error(`Unknown letter case: "${e}"`)}})(c);return Object.fromEntries(Object.values(e).map((e=>[e,s[e][a]])))},a=(e,s)=>{const{code:c}=e,a=e.uppercase[s],t=e.lowercase[s];let n;switch(c.toLowerCase()){case"tab":case"backspace":case"delete":case"capslock":case"enter":case"space":n=c.toLowerCase();break;case"shiftleft":case"shiftright":case"controlleft":case"controlright":case"metaleft":case"metaright":case"altleft":case"altright":n=c.toLowerCase().replace(/(right|left)/g,"")}const o=document.createElement("button");o.classList.add("key"),n&&o.classList.add(`key--${n}`),o.setAttribute("data-uppercase",a),o.setAttribute("data-lowercase",t),o.setAttribute("data-code",c);const r=document.createElement("div");r.classList.add("key__content");const i=document.createElement("div");i.classList.add("key__text","key__text--up-case"),i.textContent=a;const p=document.createElement("div");return p.classList.add("key__text","key__text--down-case"),a!==t&&a.toLowerCase()!==t&&(p.textContent=t??""),r.append(i,p),o.append(r),o},t=(e,s)=>{const c=document.querySelector(`[data-code=${e.code}]`);if(s){const t=a(e,s);c.innerHTML=t.innerHTML}e.isActive&&c.classList.add("key--active"),e.isActive||c.classList.remove("key--active")},n="CapsLock",o="Backspace",r="Delete",i="ArrowUp",p="ArrowDown",d="ArrowLeft",w="ArrowRight",u=(e,s)=>{const c=document.querySelector(".input-field");c.value=e,c.setSelectionRange(s,s),c.focus()},l=JSON.parse('[[{"en":{"caseDown":"`","caseUp":"~"},"ru":{"caseDown":"ё","caseUp":"Ё"},"code":"Backquote"},{"en":{"caseDown":"1","caseUp":"!"},"ru":{"caseDown":"1","caseUp":"!"},"code":"Digit1"},{"en":{"caseDown":"2","caseUp":"@"},"ru":{"caseDown":"2","caseUp":"\\""},"code":"Digit2"},{"en":{"caseDown":"3","caseUp":"#"},"ru":{"caseDown":"3","caseUp":"№"},"code":"Digit3"},{"en":{"caseDown":"4","caseUp":"$"},"ru":{"caseDown":"4","caseUp":";"},"code":"Digit4"},{"en":{"caseDown":"5","caseUp":"%"},"ru":{"caseDown":"5","caseUp":"%"},"code":"Digit5"},{"en":{"caseDown":"6","caseUp":"^"},"ru":{"caseDown":"6","caseUp":":"},"code":"Digit6"},{"en":{"caseDown":"7","caseUp":"&"},"ru":{"caseDown":"7","caseUp":"?"},"code":"Digit7"},{"en":{"caseDown":"8","caseUp":"*"},"ru":{"caseDown":"8","caseUp":"*"},"code":"Digit8"},{"en":{"caseDown":"9","caseUp":"("},"ru":{"caseDown":"9","caseUp":"("},"code":"Digit9"},{"en":{"caseDown":"0","caseUp":")"},"ru":{"caseDown":"0","caseUp":")"},"code":"Digit0"},{"en":{"caseDown":"-","caseUp":"_"},"ru":{"caseDown":"-","caseUp":"_"},"code":"Minus"},{"en":{"caseDown":"=","caseUp":"+"},"ru":{"caseDown":"=","caseUp":"+"},"code":"Equal"},{"en":{"caseDown":"Backspace","caseUp":"Backspace"},"ru":{"caseDown":"Backspace","caseUp":"Backspace"},"code":"Backspace"}],[{"en":{"caseDown":"Tab","caseUp":"Tab"},"ru":{"caseDown":"Tab","caseUp":"Tab"},"code":"Tab"},{"en":{"caseDown":"q","caseUp":"Q"},"ru":{"caseDown":"й","caseUp":"Й"},"code":"KeyQ"},{"en":{"caseDown":"w","caseUp":"W"},"ru":{"caseDown":"ц","caseUp":"Ц"},"code":"KeyW"},{"en":{"caseDown":"e","caseUp":"E"},"ru":{"caseDown":"у","caseUp":"У"},"code":"KeyE"},{"en":{"caseDown":"r","caseUp":"R"},"ru":{"caseDown":"к","caseUp":"К"},"code":"KeyR"},{"en":{"caseDown":"t","caseUp":"T"},"ru":{"caseDown":"е","caseUp":"Е"},"code":"KeyT"},{"en":{"caseDown":"y","caseUp":"Y"},"ru":{"caseDown":"н","caseUp":"Н"},"code":"KeyY"},{"en":{"caseDown":"u","caseUp":"U"},"ru":{"caseDown":"г","caseUp":"Г"},"code":"KeyU"},{"en":{"caseDown":"i","caseUp":"I"},"ru":{"caseDown":"ш","caseUp":"Ш"},"code":"KeyI"},{"en":{"caseDown":"o","caseUp":"O"},"ru":{"caseDown":"щ","caseUp":"Щ"},"code":"KeyO"},{"en":{"caseDown":"p","caseUp":"P"},"ru":{"caseDown":"з","caseUp":"З"},"code":"KeyP"},{"en":{"caseDown":"[","caseUp":"{"},"ru":{"caseDown":"х","caseUp":"Х"},"code":"BracketLeft"},{"en":{"caseDown":"]","caseUp":"}"},"ru":{"caseDown":"ъ","caseUp":"Ъ"},"code":"BracketRight"},{"en":{"caseDown":"\\\\","caseUp":"|"},"ru":{"caseDown":"\\\\","caseUp":"/"},"code":"Backslash"},{"en":{"caseDown":"Del","caseUp":"Del"},"ru":{"caseDown":"Del","caseUp":"Del"},"code":"Delete"}],[{"en":{"caseDown":"CapsLock","caseUp":"CapsLock"},"ru":{"caseDown":"CapsLock","caseUp":"CapsLock"},"code":"CapsLock"},{"en":{"caseDown":"a","caseUp":"A"},"ru":{"caseDown":"ф","caseUp":"Ф"},"code":"KeyA"},{"en":{"caseDown":"s","caseUp":"S"},"ru":{"caseDown":"ы","caseUp":"Ы"},"code":"KeyS"},{"en":{"caseDown":"d","caseUp":"D"},"ru":{"caseDown":"в","caseUp":"В"},"code":"KeyD"},{"en":{"caseDown":"f","caseUp":"F"},"ru":{"caseDown":"а","caseUp":"А"},"code":"KeyF"},{"en":{"caseDown":"g","caseUp":"G"},"ru":{"caseDown":"п","caseUp":"П"},"code":"KeyG"},{"en":{"caseDown":"h","caseUp":"H"},"ru":{"caseDown":"р","caseUp":"Р"},"code":"KeyH"},{"en":{"caseDown":"j","caseUp":"J"},"ru":{"caseDown":"о","caseUp":"О"},"code":"KeyJ"},{"en":{"caseDown":"k","caseUp":"K"},"ru":{"caseDown":"л","caseUp":"Л"},"code":"KeyK"},{"en":{"caseDown":"l","caseUp":"L"},"ru":{"caseDown":"д","caseUp":"Д"},"code":"KeyL"},{"en":{"caseDown":";","caseUp":":"},"ru":{"caseDown":"ж","caseUp":"Ж"},"code":"Semicolon"},{"en":{"caseDown":"\\"","caseUp":"\'"},"ru":{"caseDown":"э","caseUp":"Э"},"code":"Quote"},{"en":{"caseDown":"Enter","caseUp":"Enter"},"ru":{"caseDown":"Enter","caseUp":"Enter"},"code":"Enter"}],[{"en":{"caseDown":"Shift","caseUp":"Shift"},"ru":{"caseDown":"Shift","caseUp":"Shift"},"code":"ShiftLeft"},{"en":{"caseDown":"z","caseUp":"Z"},"ru":{"caseDown":"я","caseUp":"Я"},"code":"KeyZ"},{"en":{"caseDown":"x","caseUp":"X"},"ru":{"caseDown":"ч","caseUp":"Ч"},"code":"KeyX"},{"en":{"caseDown":"c","caseUp":"C"},"ru":{"caseDown":"с","caseUp":"С"},"code":"KeyC"},{"en":{"caseDown":"v","caseUp":"V"},"ru":{"caseDown":"м","caseUp":"М"},"code":"KeyV"},{"en":{"caseDown":"b","caseUp":"B"},"ru":{"caseDown":"и","caseUp":"И"},"code":"KeyB"},{"en":{"caseDown":"n","caseUp":"N"},"ru":{"caseDown":"т","caseUp":"Т"},"code":"KeyN"},{"en":{"caseDown":"m","caseUp":"M"},"ru":{"caseDown":"ь","caseUp":"Ь"},"code":"KeyM"},{"en":{"caseDown":",","caseUp":"<"},"ru":{"caseDown":"б","caseUp":"Б"},"code":"Comma"},{"en":{"caseDown":".","caseUp":">"},"ru":{"caseDown":"ю","caseUp":"Ю"},"code":"Period"},{"en":{"caseDown":"/","caseUp":"?"},"ru":{"caseDown":".","caseUp":","},"code":"Slash"},{"en":{"caseDown":"↑","caseUp":"↑"},"ru":{"caseDown":"↑","caseUp":"↑"},"code":"ArrowUp"},{"en":{"caseDown":"Shift","caseUp":"Shift"},"ru":{"caseDown":"Shift","caseUp":"Shift"},"code":"ShiftRight"}],[{"en":{"caseDown":"Ctrl","caseUp":"Ctrl"},"ru":{"caseDown":"Ctrl","caseUp":"Ctrl"},"code":"ControlLeft"},{"en":{"caseDown":"Win","caseUp":"Win"},"ru":{"caseDown":"Win","caseUp":"Win"},"code":"MetaLeft"},{"en":{"caseDown":"Alt","caseUp":"Alt"},"ru":{"caseDown":"Alt","caseUp":"Alt"},"code":"AltLeft"},{"en":{"caseDown":" ","caseUp":" "},"ru":{"caseDown":" ","caseUp":" "},"code":"Space"},{"en":{"caseDown":"Alt","caseUp":"Alt"},"ru":{"caseDown":"Alt","caseUp":"Alt"},"code":"AltRight"},{"en":{"caseDown":"←","caseUp":"←"},"ru":{"caseDown":"←","caseUp":"←"},"code":"ArrowLeft"},{"en":{"caseDown":"↓","caseUp":"↓"},"ru":{"caseDown":"↓","caseUp":"↓"},"code":"ArrowDown"},{"en":{"caseDown":"→","caseUp":"→"},"ru":{"caseDown":"→","caseUp":"→"},"code":"ArrowRight"},{"en":{"caseDown":"Ctrl","caseUp":"Ctrl"},"ru":{"caseDown":"Ctrl","caseUp":"Ctrl"},"code":"ControlRight"}]]');document.addEventListener("DOMContentLoaded",(()=>{const h=localStorage.getItem("lang"),D=l.flatMap(((a,t)=>a.map((a=>new class{uppercase={};lowercase={};code;row;isActive=!1;constructor({code:e,caseUp:s,caseDown:c,row:a}){this.code=e,this.uppercase=s,this.lowercase=c,this.row=a}isLetter(c){switch(c){case e.EN:return s(this.uppercase[e.EN]);case e.RU:return s(this.uppercase[e.RU]);default:return!1}}}({code:a.code,caseUp:c({key:a,letterCase:"upper"}),caseDown:c({key:a,letterCase:"lower"}),row:t}))))),U=new class{state={value:"",capsLock:!1,lng:e.EN};keys=[];keyElems=[];constructor(e,s){s&&(this.state.lng=s),this.keys=e}toggleCapslock(){this.state.capsLock=!this.state.capsLock}getCurrentValue(){return this.state.value}getKeyByCode(e){return this.keys.find((s=>s.code===e))}updateValue(e){const s=this.getKeyByCode(e),c=this.keys.filter((e=>e.code.startsWith("Shift"))).some((e=>e.isActive));let a;switch(e){case"ControlLeft":case"ControlRight":case"ShiftLeft":case"ShiftRight":case"AltLeft":case"AltRight":case"MetaLeft":case r:case o:case d:case w:case i:case p:case n:a="";break;case"Tab":a="\t";break;case"Enter":a="\n";break;default:if(!this.state.capsLock&&c){a=s.uppercase[this.state.lng];break}if(this.state.capsLock&&!c){a=s.isLetter(this.state.lng)?s.uppercase[this.state.lng]:s.lowercase[this.state.lng];break}if(this.state.capsLock&&c){a=s.isLetter(this.state.lng)?s.lowercase[this.state.lng]:s.uppercase[this.state.lng];break}a=s.lowercase[this.state.lng]}this.state={...this.state,value:a}}pressKey(e){if(e===n&&this.state.capsLock)return void this.setKeyActive(e);if(e===n&&!this.state.capsLock)return void this.setKeyInactive(e);const s=this.getKeyByCode(e);s&&((e=>{document.querySelector(`[data-code=${e.code}]`).classList.add("key--pressed")})(s),this.updateValue(e))}setKeyActive(e){const s=this.getKeyByCode(e);s.isActive=!0,t(s)}setKeyInactive(e){if(e===n&&this.state.capsLock)return;const s=this.getKeyByCode(e);s.isActive=!1,t(s)}switchLanguage(){this.state.lng=this.state.lng===e.EN?e.RU:e.EN,this.keys.forEach((e=>t(e,this.state.lng)))}init(e){const s=[];this.keys.forEach((e=>{s[e.row]||(s[e.row]=[]),s[e.row].push(e)})),((e,s,c)=>{const t=((e,s)=>{const c=document.createElement("div");c.classList.add("keyboard");const t=document.createElement("div");t.classList.add("keyboard__inner");const n=e.map((e=>{const c=document.createElement("div");c.classList.add("keyboard__row");const t=e.map((e=>{const c=a(e,s);return c.classList.add("keyboard__key"),c}));return c.append(...t),c}));return t.append(...n),c.append(t),c})(e,this.state.lng);s.append(t)})(s,e)}}(D,h),y=new class{charsArr=[];inputEl=null;focus(){this.inputEl.focus()}addCharacter(e){if(0===e.length)return void this.focus();const s=this.inputEl.selectionStart,c=this.inputEl.selectionEnd;s!==c&&this.removeRange(s,c),this.charsArr.splice(s,0,e),u(this.charsArr.join(""),s+1)}removeRange(e,s){this.charsArr=this.charsArr.filter(((c,a)=>a<e||a>=s)),u(this.charsArr.join(""),e)}removePrevChar(){const e=this.inputEl.selectionStart,s=this.inputEl.selectionEnd;e===s?(this.charsArr=this.charsArr.filter(((s,c)=>c!==e-1)),u(this.charsArr.join(""),Math.max(e-1,0))):this.removeRange(e,s)}removeNextChar(){const e=this.inputEl.selectionStart,s=this.inputEl.selectionEnd;e===s?(this.charsArr=this.charsArr.filter(((s,c)=>c!==e)),u(this.charsArr.join(""),e)):this.removeRange(e,s)}moveCursorLeft(){const e=this.inputEl.selectionStart,s=e!==this.inputEl.selectionEnd?e:e-1;u(this.charsArr.join(""),Math.max(s,0))}moveCursorRight(){const e=this.inputEl.selectionStart,s=e!==this.inputEl.selectionEnd?e:e+1;u(this.charsArr.join(""),Math.min(s,this.charsArr.length))}init(e){this.inputEl=(e=>{const s=(()=>{const e=document.createElement("textarea");return e.classList.add("input-field"),e})();return e.append(s),s})(e)}},g=document.createElement("main");g.classList.add("app"),y.init(g),U.init(g);const k=document.createElement("div");k.classList.add("description"),k.innerHTML="\n  <p>The virtual keyboard was created in Windows OS</p>\n  <p>Press Shift + Alt to change language</p>\n  ",g.append(k),document.body.append(g),window.addEventListener("keydown",(e=>((e,s,c)=>{const{code:a}=e;s.getKeyByCode(a)&&(a!==i&&a!==p&&e.preventDefault(),s.setKeyActive(a),s.updateValue(a),a===n&&s.toggleCapslock(),a!==o?a!==r?a!==d?a!==w?c.addCharacter(s.getCurrentValue()):c.moveCursorRight():c.moveCursorLeft():c.removeNextChar():c.removePrevChar())})(e,U,y))),window.addEventListener("keyup",(e=>((e,s)=>{if(e.repeat)return;const{code:c,altKey:a,shiftKey:t}=e;s.getKeyByCode(c)&&((t&&c.startsWith("Alt")||a&&c.startsWith("Shift"))&&s.switchLanguage(),setTimeout((()=>s.setKeyInactive(c)),200))})(e,U))),document.querySelectorAll(".keyboard__key").forEach((e=>{e.addEventListener("click",(e=>((e,s,c)=>{const{code:a}=e.currentTarget.dataset;if(a===n)return s.toggleCapslock(),s.state.capsLock?s.setKeyActive(a):s.setKeyInactive(a),void c.focus();s.pressKey(a),a!==o?a!==r?a!==d?a!==w?c.addCharacter(s.getCurrentValue()):c.moveCursorRight():c.moveCursorLeft():c.removeNextChar():c.removePrevChar()})(e,U,y))),e.addEventListener("animationend",(()=>e.classList.remove("key--pressed")))})),window.addEventListener("unload",(()=>localStorage.setItem("lang",U.state.lng)))}))})();